<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courgette&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Gestione Prenotazioni - NOMEPIZZERIA</title>
</head>
<style>
   body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f5a623, #f76b1c);
    margin: 0;
    padding: 20px;
    text-align: center;
    color: white;
}
h1 {
    font-family: 'Courgette', cursive;
    font-size: 50px;
    margin-bottom: 30px;
    text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}
table {
    border-collapse: collapse;
    width: 90%;
    max-width: 900px;
    margin: 20px auto;
    background: rgba(255,255,255,0.9);
    color: #333;
    border-radius: 10px;
    overflow: hidden;
}
th, td {
    padding: 12px;
    border: 1px solid #ccc;
    text-align: center;
}
th {
    background-color: orange;
    color: white;
    font-weight: bold;
}
tr:nth-child(even) {background: #f9f9f9;}
.box-link {
    display: inline-block;
    padding: 10px 20px;
    margin: 10px;
    background-color: #947444;
    color: white;
    text-decoration: none;
    font-family: 'Courgette', sans-serif;
    font-size: 18px;
    border-radius: 10px;
    transition: transform 0.2s, background-color 0.2s;
    border: none;
    cursor: pointer;
}
.box-link:hover {
    transform: scale(1.1);
    background-color: #ffa500;
}
</style>
<body>
    <h1>ðŸ“‹ Lista Prenotazioni</h1>

    <button id="start-audio" class="box-link">Allerta nuove prenotazioni</button>
    <button id="stop-audio" class="box-link">Interrompi beep</button>

    <table id="tabella-prenotazioni">
        <tr>
            <th>Nome</th>
            <th>Telefono</th>
            <th>Persone</th>
            <th>Orario</th>
            <th>Giorno</th>
        </tr>
    </table>

<script>
let audio = new Audio('suoni/notifica.mp3');
let audioInterval;

// Abilita beep
document.getElementById('start-audio').addEventListener('click', () => {
    if (!audioInterval) {
        audioInterval = setInterval(() => {
            audio.play().catch(err => console.log("Audio non riprodotto:", err));
        }, 5000);
    }
});

// Interrompi beep
document.getElementById('stop-audio').addEventListener('click', () => {
    if (audioInterval) {
        clearInterval(audioInterval);
        audioInterval = null;
        audio.pause();
        audio.currentTime = 0;
    }
});

// Polling prenotazioni
const pollInterval = 5000;
let lastPrenotazioniIds = [];

async function caricaPrenotazioni() {
    try {
        const response = await fetch("https://sito-pizzeria-4hzy.onrender.com/prenotazioni");
        const data = await response.json();

        let html = `
        <tr>
            <th>Nome</th>
            <th>Telefono</th>
            <th>Persone</th>
            <th>Orario</th>
            <th>Giorno</th>
        </tr>`;
        data.forEach(p => {
            html += `
            <tr>
                <td>${p.nome}</td>
                <td>${p.telefono}</td>
                <td>${p.persone}</td>
                <td>${p.orario}</td>
                <td>${new Date(p.giorno).toLocaleString("it-IT")}</td>
            </tr>`;
        });
        document.getElementById("tabella-prenotazioni").innerHTML = html;

        const currentIds = data.map(p => p.id);
        if (lastPrenotazioniIds.length && currentIds.length > lastPrenotazioniIds.length) {
            if (audioInterval) {
                audio.play().catch(err => console.log("Audio non riprodotto:", err));
            }
        }
        lastPrenotazioniIds = currentIds;

    } catch (err) {
        console.error("Errore caricamento prenotazioni:", err);
    }
}

setInterval(caricaPrenotazioni, pollInterval);
caricaPrenotazioni(); 
</script>
</body>
</html>
