<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courgette&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <title>Gestione Prenotazioni - NOMEPIZZERIA</title>
</head>
<style>
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f5a623, #f76b1c);
    color: #333;
    margin: 0;
    padding: 20px;
    text-align: center;
}
h1 {
    color: white;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
table {
    border-collapse: collapse;
    width: 90%;
    max-width: 900px;
    margin: 20px auto;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
}
th, td {
    padding: 12px;
    border: 1px solid #ddd;
    text-align: center;
}
th {
    background: orange;
    color: white;
    font-weight: bold;
}
tr:nth-child(even) {
    background: #f9f9f9;
}
</style>
<body>
<h1>ðŸ“‹ Lista Prenotazioni</h1>

<table id="tabella-prenotazioni">
    <tr>
        <th>Nome</th>
        <th>Telefono</th>
        <th>Persone</th>
        <th>Orario</th>
        <th>Giorno</th>
    </tr>
</table>

<script>
const pollInterval = 5000; // ogni 5 secondi
let lastPrenotazioniIds = [];

async function caricaPrenotazioni() {
    try {
        const response = await fetch("https://sito-pizzeria-4hzy.onrender.com/prenotazioni"); // endpoint che restituisce JSON
        const data = await response.json(); // qui ci aspettiamo JSON

        // costruisci tabella
        let html = `
        <tr>
            <th>Nome</th>
            <th>Telefono</th>
            <th>Persone</th>
            <th>Orario</th>
            <th>Giorno</th>
        </tr>
        `;
        data.forEach(p => {
            html += `
            <tr>
                <td>${p.nome}</td>
                <td>${p.telefono}</td>
                <td>${p.persone}</td>
                <td>${p.orario}</td>
                <td>${new Date(p.giorno).toLocaleString("it-IT")}</td>
            </tr>
            `;
        });
        document.getElementById("tabella-prenotazioni").innerHTML = html;

        // suono se ci sono nuove prenotazioni
        const currentIds = data.map(p => p.id);
        if (lastPrenotazioniIds.length && currentIds.length > lastPrenotazioniIds.length) {
            const audio = new Audio("suoni/notifica.mp3");
            audio.play().catch(err => console.log("Audio non riprodotto:", err));
        }
        lastPrenotazioniIds = currentIds;

    } catch (err) {
        console.error("Errore caricamento prenotazioni:", err);
    }
}

// avvio polling
setInterval(caricaPrenotazioni, pollInterval);
caricaPrenotazioni(); // subito al caricamento
</script>

</body>
</html>
