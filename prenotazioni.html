<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Courgette&display=swap" rel="stylesheet">
    <title>Lista Prenotazioni</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5a623, #f76b1c);
            color: #fff;
            text-align: center;
        }
        h1 {
            font-family: 'Courgette', cursive;
            font-size: 50px;
            margin-top: 20px;
            text-shadow: 2px 2px 5px #000;
        }
        table {
            margin: 30px auto;
            border-collapse: collapse;
            width: 80%;
            max-width: 800px;
            background-color: rgba(255,255,255,0.8);
            color: #000;
            border-radius: 10px;
            overflow: hidden;
        }
        th, td {
            padding: 12px;
            border-bottom: 1px solid #ccc;
        }
        th {
            background-color: orange;
            color: white;
        }
        tr:hover {
            background-color: rgba(255, 165, 0, 0.3);
        }
    </style>
</head>
<body>

<h1>Ultime Prenotazioni</h1>

<table id="tabella-prenotazioni">
    <tr>
        <th>Nome</th>
        <th>Telefono</th>
        <th>Persone</th>
        <th>Orario</th>
        <th>Giorno</th>
    </tr>
</table>

<script>
    const pollInterval = 5000; // ogni 5 secondi
    let lastPrenotazioniIds = [];

    async function aggiornaPrenotazioni() {
        try {
            const response = await fetch("https://sito-pizzeria-4hzy.onrender.com/prenotazioni");
            const data = await response.json();

            // Aggiorna la tabella
            const container = document.getElementById("tabella-prenotazioni");
            let html = `
                <tr>
                    <th>Nome</th>
                    <th>Telefono</th>
                    <th>Persone</th>
                    <th>Orario</th>
                    <th>Giorno</th>
                </tr>
            `;
            data.forEach(p => {
                html += `
                    <tr>
                        <td>${p.nome}</td>
                        <td>${p.telefono}</td>
                        <td>${p.persone}</td>
                        <td>${p.orario}</td>
                        <td>${new Date(p.giorno).toLocaleString()}</td>
                    </tr>
                `;
            });
            container.innerHTML = html;

            // Beep se ci sono nuove prenotazioni
            const currentIds = data.map(p => p.id);
            if (lastPrenotazioniIds.length && currentIds.length > lastPrenotazioniIds.length) {
                const audio = new Audio('suoni/notifica.mp3'); // il file mp3 deve essere nella stessa cartella
                audio.play();
            }
            lastPrenotazioniIds = currentIds;

        } catch (err) {
            console.error("Errore nel polling prenotazioni:", err);
        }
    }

    // Polling automatico
    setInterval(aggiornaPrenotazioni, pollInterval);
    aggiornaPrenotazioni(); // subito al caricamento
</script>

</body>
</html>
