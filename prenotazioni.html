<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Prenotazioni Staff</title>
</head>
<body>
    <h1>Ultime Prenotazioni</h1>
    <table id="tabella-prenotazioni">
        <tr>
            <th>Nome</th>
            <th>Telefono</th>
            <th>Persone</th>
            <th>Orario</th>
            <th>Giorno</th>
        </tr>
    </table>

    <script>
        let lastPrenotazioniIds = [];

        async function aggiornaPrenotazioni() {
            try {
                const response = await fetch("https://sito-pizzeria-4hzy.onrender.com/prenotazioni");
                const data = await response.json();

                // Aggiorna la tabella
                let html = `<tr>
                                <th>Nome</th>
                                <th>Telefono</th>
                                <th>Persone</th>
                                <th>Orario</th>
                                <th>Giorno</th>
                            </tr>`;
                data.forEach(p => {
                    html += `<tr>
                                <td>${p.nome}</td>
                                <td>${p.telefono}</td>
                                <td>${p.persone}</td>
                                <td>${p.orario}</td>
                                <td>${new Date(p.giorno).toLocaleString()}</td>
                             </tr>`;
                });
                document.getElementById("tabella-prenotazioni").innerHTML = html;

                // Suono beep se ci sono nuove prenotazioni
                const currentIds = data.map(p => p.id);
                if(lastPrenotazioniIds.length && currentIds.length > lastPrenotazioniIds.length){
                    const audio = new Audio('suoni/notifica.mp3'); // mettere beep.mp3 nella stessa cartella
                    audio.play();
                }
                lastPrenotazioniIds = currentIds;

            } catch(err) {
                console.error("Errore nel polling prenotazioni:", err);
            }
        }

        setInterval(aggiornaPrenotazioni, 5000); // ogni 5 secondi
        aggiornaPrenotazioni(); // subito al caricamento
    </script>
</body>
</html>
